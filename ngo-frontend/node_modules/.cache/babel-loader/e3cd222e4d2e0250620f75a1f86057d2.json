{"ast":null,"code":"import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\nconst baseUrl = `http://localhost:4000/api/v1`;\nexport const userSlice = createSlice({\n  name: \"authentication\",\n  initialState: {\n    user: {\n      _id: \"\",\n      first_name: \"\",\n      username: \"\",\n      last_name: \"\",\n      email: \"\",\n      role: \"\"\n    },\n    token: \"\",\n    pending: false,\n    error: false,\n    error_message: ''\n  },\n  reducers: {},\n  extraReducers: {\n    //? \n    [authenticateUser.pending]: state => {\n      state.pending = true;\n    },\n    [authenticateUser.fulfilled]: (state, action) => {\n      state.pending = false;\n      state.user = action.payload.userData;\n      state.token = action.payload.token;\n    },\n    [authenticateUser.rejected]: (state, action) => {\n      state.pending = false;\n      state.error = true;\n      state.error_message = action.error.message;\n    },\n    [logoutUser.fulfilled]: (state, action) => {\n      state.user = null;\n    },\n    [logoutUser.rejected]: (state, action) => {\n      state.error = true;\n      state.error_message = action.error.message;\n    }\n  }\n});\n/**\n  * @route Login route\n  * @desc login existing user and generates JWT token\n  * @middleware validate login credentials\n  * @param  string $request - route request\n            string $response - route response\n  * @return returns response\n*/\n\nexport const authenticateUser = createAsyncThunk(\"users/authenticate\", async user => {\n  const response = await fetch(`${baseUrl}/accounts/login`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(user)\n  });\n  const json = await response.json();\n\n  if (response.ok) {\n    localStorage.setItem(\"Authentication-token\", json.token);\n    return json;\n  } else {\n    throw new Error(json.message);\n  }\n});\nexport const logoutUser = createAsyncThunk(\"users/logout\", async () => {\n  localStorage.removeItem('Authentication-token'); // TODO: Redirect to home page insted and show alert message.\n\n  return \"logged out\";\n});\nexport default userSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","baseUrl","userSlice","name","initialState","user","_id","first_name","username","last_name","email","role","token","pending","error","error_message","reducers","extraReducers","authenticateUser","state","fulfilled","action","payload","userData","rejected","message","logoutUser","response","fetch","method","headers","body","JSON","stringify","json","ok","localStorage","setItem","Error","removeItem","reducer"],"sources":["/Users/akarshjain/Desktop/bookoe/src/redux/Slices/authenticationSlice.js"],"sourcesContent":["import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\n\nconst baseUrl = `http://localhost:4000/api/v1`;\n\nexport const userSlice = createSlice({\n    name: \"authentication\",\n    initialState: {\n      user: {\n        _id: \"\",\n        first_name: \"\",\n        username: \"\",\n        last_name: \"\",\n        email: \"\",\n        role: \"\",\n      },\n      token: \"\",\n      pending: false,\n      error: false,\n      error_message: ''\n    },\n    reducers: {},\n    extraReducers: {\n        //? \n      [authenticateUser.pending]: (state) => {\n        state.pending = true;\n      },\n      [authenticateUser.fulfilled]: (state, action) => {\n        state.pending = false;\n        state.user = action.payload.userData;\n        state.token = action.payload.token;\n      },\n      [authenticateUser.rejected]: (state, action) => {\n        state.pending = false;\n        state.error = true;\n        state.error_message = action.error.message;\n      },\n  \n      [logoutUser.fulfilled]: (state, action) => {\n          state.user = null;\n      },\n      [logoutUser.rejected]: (state, action) => {\n          state.error = true;\n          state.error_message = action.error.message;\n      },\n    },\n  });\n\n/**\n  * @route Login route\n  * @desc login existing user and generates JWT token\n  * @middleware validate login credentials\n  * @param  string $request - route request\n            string $response - route response\n  * @return returns response\n*/\nexport const authenticateUser = createAsyncThunk(\n  \"users/authenticate\",\n  async (user) => {\n      const response = await fetch(`${baseUrl}/accounts/login`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(user),\n      });\n\n    const json = await response.json(); \n    if(response.ok){\n        localStorage.setItem(\"Authentication-token\", json.token);\n        return json;\n    }\n    else{\n        throw new Error(json.message);\n    }\n  }\n);\n\nexport const logoutUser = createAsyncThunk(\n    \"users/logout\",\n    async () => {\n        localStorage.removeItem('Authentication-token');\n        // TODO: Redirect to home page insted and show alert message.\n        return \"logged out\"\n    }\n  );\n\nexport default userSlice.reducer;\n"],"mappings":"AAAA,SAASA,gBAAT,EAA2BC,WAA3B,QAA8C,kBAA9C;AAEA,MAAMC,OAAO,GAAI,8BAAjB;AAEA,OAAO,MAAMC,SAAS,GAAGF,WAAW,CAAC;EACjCG,IAAI,EAAE,gBAD2B;EAEjCC,YAAY,EAAE;IACZC,IAAI,EAAE;MACJC,GAAG,EAAE,EADD;MAEJC,UAAU,EAAE,EAFR;MAGJC,QAAQ,EAAE,EAHN;MAIJC,SAAS,EAAE,EAJP;MAKJC,KAAK,EAAE,EALH;MAMJC,IAAI,EAAE;IANF,CADM;IASZC,KAAK,EAAE,EATK;IAUZC,OAAO,EAAE,KAVG;IAWZC,KAAK,EAAE,KAXK;IAYZC,aAAa,EAAE;EAZH,CAFmB;EAgBjCC,QAAQ,EAAE,EAhBuB;EAiBjCC,aAAa,EAAE;IACX;IACF,CAACC,gBAAgB,CAACL,OAAlB,GAA6BM,KAAD,IAAW;MACrCA,KAAK,CAACN,OAAN,GAAgB,IAAhB;IACD,CAJY;IAKb,CAACK,gBAAgB,CAACE,SAAlB,GAA8B,CAACD,KAAD,EAAQE,MAAR,KAAmB;MAC/CF,KAAK,CAACN,OAAN,GAAgB,KAAhB;MACAM,KAAK,CAACd,IAAN,GAAagB,MAAM,CAACC,OAAP,CAAeC,QAA5B;MACAJ,KAAK,CAACP,KAAN,GAAcS,MAAM,CAACC,OAAP,CAAeV,KAA7B;IACD,CATY;IAUb,CAACM,gBAAgB,CAACM,QAAlB,GAA6B,CAACL,KAAD,EAAQE,MAAR,KAAmB;MAC9CF,KAAK,CAACN,OAAN,GAAgB,KAAhB;MACAM,KAAK,CAACL,KAAN,GAAc,IAAd;MACAK,KAAK,CAACJ,aAAN,GAAsBM,MAAM,CAACP,KAAP,CAAaW,OAAnC;IACD,CAdY;IAgBb,CAACC,UAAU,CAACN,SAAZ,GAAwB,CAACD,KAAD,EAAQE,MAAR,KAAmB;MACvCF,KAAK,CAACd,IAAN,GAAa,IAAb;IACH,CAlBY;IAmBb,CAACqB,UAAU,CAACF,QAAZ,GAAuB,CAACL,KAAD,EAAQE,MAAR,KAAmB;MACtCF,KAAK,CAACL,KAAN,GAAc,IAAd;MACAK,KAAK,CAACJ,aAAN,GAAsBM,MAAM,CAACP,KAAP,CAAaW,OAAnC;IACH;EAtBY;AAjBkB,CAAD,CAA7B;AA2CP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMP,gBAAgB,GAAGnB,gBAAgB,CAC9C,oBAD8C,EAE9C,MAAOM,IAAP,IAAgB;EACZ,MAAMsB,QAAQ,GAAG,MAAMC,KAAK,CAAE,GAAE3B,OAAQ,iBAAZ,EAA8B;IACxD4B,MAAM,EAAE,MADgD;IAExDC,OAAO,EAAE;MACP,gBAAgB;IADT,CAF+C;IAKxDC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe5B,IAAf;EALkD,CAA9B,CAA5B;EAQF,MAAM6B,IAAI,GAAG,MAAMP,QAAQ,CAACO,IAAT,EAAnB;;EACA,IAAGP,QAAQ,CAACQ,EAAZ,EAAe;IACXC,YAAY,CAACC,OAAb,CAAqB,sBAArB,EAA6CH,IAAI,CAACtB,KAAlD;IACA,OAAOsB,IAAP;EACH,CAHD,MAII;IACA,MAAM,IAAII,KAAJ,CAAUJ,IAAI,CAACT,OAAf,CAAN;EACH;AACF,CAnB6C,CAAzC;AAsBP,OAAO,MAAMC,UAAU,GAAG3B,gBAAgB,CACtC,cADsC,EAEtC,YAAY;EACRqC,YAAY,CAACG,UAAb,CAAwB,sBAAxB,EADQ,CAER;;EACA,OAAO,YAAP;AACH,CANqC,CAAnC;AASP,eAAerC,SAAS,CAACsC,OAAzB"},"metadata":{},"sourceType":"module"}